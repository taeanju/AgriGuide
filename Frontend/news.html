<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AgriGuide ‚Äì Scheme News</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="styles.css" />
  <style>
    ul#news-list {
      list-style: none;
      padding: 0;
    }
    li.news-item {
      border-bottom: 1px solid #ddd;
      padding: 1rem 0;
      display: flex;
      flex-direction: row;
      gap: 1rem;
    }
    .news-content {
      flex: 1;
    }
    .news-thumb {
      width: 120px;
      height: 80px;
      object-fit: cover;
      border-radius: 6px;
    }
    .news-item h3 {
      font-size: 1.1rem;
      margin: 0 0 0.4rem;
      color: #2e7d32;
    }
    .news-item p {
      margin: 0.3rem 0;
    }
    button.listen-btn {
      background-color: #2e7d32;
      color: white;
      border: none;
      padding: 0.3rem 0.6rem;
      margin-top: 0.3rem;
      border-radius: 4px;
      cursor: pointer;
    }
    button.listen-btn:hover {
      background-color: #1b5e20;
    }
    #backToTop {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background-color: #2e7d32;
      color: white;
      border: none;
      border-radius: 50%;
      padding: 0.6rem 1rem;
      font-size: 18px;
      cursor: pointer;
      display: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    #backToTop:hover {
      background-color: #1b5e20;
    }
  </style>
</head>
<body>
  <nav>
    <ul>
      <li><a href="home.html">üè† Home</a></li>
      <li><a href="prediction.html">üîç Prediction</a></li>
      <li><a href="news.html">üì∞ News</a></li>
      <li><a href="advancements.html">üåæ Advancements</a></li>
    </ul>
  </nav>

  <div class="container">
    <h1> News Feed</h1>
    <ul id="news-list"><li>Loading news‚Ä¶</li></ul>
  </div>

  <button id="backToTop" title="Go to top">‚Üë</button>

  <script>
    const apiKey = "pub_3cab90cd787e47f98acb8cad47e8e686"; // Replace with your actual key
    let newsData = [];
    let currentIndex = 0;
    const batchSize = 5;
    const newsList = document.getElementById("news-list");

    function fetchNews() {
      const url = `https://newsdata.io/api/1/news?apikey=${apiKey}&q=farmer+scheme+india&country=in&language=en`;

      fetch(url)
        .then(res => res.json())
        .then(data => {
          if (!data.results || data.results.length === 0) {
            newsList.innerHTML = "<li>üö´ No scheme news found.</li>";
            return;
          }

          newsData = data.results;
          currentIndex = 0;
          newsList.innerHTML = "";
          renderNewsBatch();
        })
        .catch(() => {
          newsList.innerHTML = "<li>‚ö†Ô∏è Failed to load news.</li>";
        });
    }

    function renderNewsBatch() {
      const nextIndex = Math.min(currentIndex + batchSize, newsData.length);

      for (let i = currentIndex; i < nextIndex; i++) {
        const article = newsData[i];
        const title = article.title || "Untitled";
        const description = article.description || "";
        const image = article.image_url || "";
        const link = article.link || "#";

        const li = document.createElement("li");
        li.classList.add("news-item");

        li.innerHTML = `
          ${image ? `<img src="${image}" class="news-thumb" alt="News Image">` : ""}
          <div class="news-content">
            <h3><a href="${link}" target="_blank">${title}</a></h3>
            <p>${description.slice(0, 200)}...</p>
            <button class="listen-btn" onclick='speak(${JSON.stringify(title + ". " + description)})'>üîä Listen</button>
          </div>
        `;

        newsList.appendChild(li);
      }

      currentIndex = nextIndex;
    }

    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      speechSynthesis.speak(utterance);
    }

    // Infinite Scroll
    window.addEventListener("scroll", () => {
      if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 100) {
        if (currentIndex < newsData.length) {
          renderNewsBatch();
        }
      }

      document.getElementById("backToTop").style.display =
        window.scrollY > 300 ? "block" : "none";
    });

    // Scroll to Top
    document.getElementById("backToTop").addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    fetchNews();
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(() => console.log('‚úÖ Service Worker registered'))
        .catch(console.error);
    }
  </script>
</body>
</html>
